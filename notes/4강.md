# 핵심 정리

## 📚 학습 목표

이 튜토리얼을 통해 다음을 배울 수 있습니다:

- Dockerfile이 무엇인지와 왜 필요한지
- Dockerfile의 핵심 명령어들과 사용법
- Node.js 웹서버를 Docker 이미지로 만드는 실습
- 이미지 빌드와 실행까지의 전체 워크플로우

## 🤔 Docker 이미지가 필요한 이유

내 프로그램을 이미지로 만들어두면 아무 컴퓨터에서나 그걸 내려받아서 매우 쉽게 실행할 수 있습니다.

### 이미지 만드는 과정

1. 코드 근처에 **Dockerfile** 하나 만들기
2. 이미지에 뭘 넣을지 작성하기
3. 같은 곳에서 터미널 열어서 **docker build** 명령어 입력하면 이미지 생성

### Dockerfile에 넣을 수 있는 것들

- 어떤 OS를 설치할건지
- 어떤 프로그램을 설치할건지
- 어떤 터미널 명령어를 실행할건지
- 내 컴퓨터에 있던 파일을 어디에 집어넣을 것인지

**핵심 개념**: 내 프로그램을 돌리고 싶으면 무슨 짓을 차례로 해야하는지 여기다가 전부 적어놓으면 됩니다.

## 1️⃣ FROM 명령어 - OS 환경 선택

어떤 OS 환경에서 내 프로그램을 실행할지부터 정해야 하는데 그건 **FROM**으로 정할 수 있습니다.

**Dockerfile은 항상 FROM부터 시작합니다.**

### Docker Hub에서 이미지 찾기

FROM 뒤에 어떤 OS를 설치해서 시작할건지 정하면 되는데, 그건 Docker Hub에서 찾아오면 됩니다.

### OS만 설치하기

```docker
FROM ubuntu:25.04

```

- 윈도우 설치하고 싶으면 `windows` 검색
- 리눅스 OS 설치하고 싶으면 `ubuntu`, `debian`, `redhat`, `alpine` 검색
- **보통은 리눅스가 서버비가 덜 들기 때문에 리눅스를 씁니다**

### 프로그래밍 언어 + OS 함께 설치 (권장)

```docker
FROM node:22-alpine

```

- 아예 리눅스 + Node.js 함께 설치된걸 이미 만들어둔 사람들이 있음
- `node`, `python`, `java` 등을 검색하면 리눅스와 셋트로 제공해주는 이미지들이 많음

### 태그 종류

- **slim**: debian 리눅스에서 필요없는거 지운 버전
- **alpine**: 용량이 가장 작은 리눅스 (보통 선호됨)

### 실습 예제

```docker
FROM node:20-slim

```

원래 내가 쓰던 Node.js 버전 쓰는게 좋습니다.

### 특수한 경우

```docker
FROM scratch

```

바이너리로 컴파일한 파일만 돌리면 되는 경우엔 OS 설치가 딱히 필요없을 수 있는데, 그럴 땐 빈 도화지에서 시작하라고 이런걸 쓰기도 합니다.

## 2️⃣ WORKDIR 명령어 - 작업 폴더 설정

파일 복사하기 전에 폴더 이동을 해봅시다. 이미지 기본 경로에 옮기면 파일이 좀 많으면 더러울 수 있으니까 `/app` 같은 폴더 하나 만들어서 거기로 이동합시다.

```docker
FROM node:20-slim
WORKDIR /app

```

### WORKDIR의 기능

- 현재 작업경로를 `/app` 폴더로 바꿔줌
- `/app` 폴더가 없으면 하나 만들어줌
- 터미널 명령어 중에 `cd`와 비슷한 역할

## 3️⃣ COPY 명령어 - 파일 복사

내 컴퓨터에 있던 파일을 이미지로 복사하려면 **COPY** 명령어를 씁니다.

### 기본 문법

```
COPY 내컴퓨터파일경로 이미지내부파일경로

```

COPY 명령어 뒤에는 경로 2개를 적을 수 있는데:

- **왼쪽**: 내 컴퓨터 폴더경로
- **오른쪽**: 이미지 어디로 옮길건지

### 모든 파일 복사

```docker
FROM node:20-slim
WORKDIR /app
COPY . .

```

**마침표는 현재 경로라는 뜻**이기 때문에:

- 첫 번째 `.`: Dockerfile 현재경로 옆에 있던 모든 파일과 폴더들
- 두 번째 `.`: 가상컴퓨터 현재경로로 복사

그러면 소스코드도 전부 복사되어서 편합니다.

### .dockerignore 파일로 제외하기

```
.git
Dockerfile
node_modules

```

이러면 `node_modules` 같은 라이브러리 소스코드도 복사해줄텐데 굳이 그건 복사할 필요는 없습니다.

**복사하기 싫은 파일이 있으면 `.dockerignore` 파일 만들어서 파일이나 폴더경로 기재해두면 됩니다.**

## 4️⃣ RUN 명령어 - 명령어 실행

`npm install express` 이런걸 해서 라이브러리를 설치했었는데, 이걸 똑같이 하라고 하고 싶으면 Dockerfile에서 **RUN** 명령어 뒤에 적으면 됩니다.

### 기본 사용법

```docker
FROM node:20-slim
WORKDIR /app
COPY . .
RUN npm install express

```

**RUN npm install express** 하면 RUN 뒤에 있는걸 터미널 명령어처럼 실행해줍니다.

RUN은 여러번 써도 됩니다.

### 문제점과 해결책

**문제점:**

- 설치할 라이브러리가 100개 있으면 100줄 써야함
- 최신 버전 express 라이브러리를 설치해주기 때문에 귀찮아질 수 있음

**해결책: package.json 활용**

- 내가 쓰던 `package.json` 파일을 먼저 똑같이 복사해오고
- 그 다음에 `npm install`만 입력하면
- 그 package.json에 기록되어있던 라이브러리를 그대로 설치해주는 기능 사용

**package.json은 설치된 라이브러리가 기록되어있는 파일입니다.**

### 안정적인 RUN 사용법

```docker
FROM node:20-slim
WORKDIR /app
COPY . .
RUN ["npm", "install"]

```

**대괄호치는게 더 안정적인 방식입니다.**

### 괄호 없는 방식 vs 괄호 있는 방식

**괄호 없으면:** `/bin/sh -c npm install` 명령어가 실행

- 내 OS에 기본적으로 설치된 shell을 이용해서 실행
- shell 기능과 `&&`, `||` 이런 명령어가 필요하면 괄호없이 사용

**괄호 있으면:** 더 안정적

- shell 기능이 필요없거나 OS마다 shell이 서로 다를 수 있기 때문에 불안하면 대괄호 사용

## 5️⃣ CMD 명령어 - 실행 명령어

마지막으로 `node server.js` 입력하면 파일이 실행되고 웹서버가 실행됩니다.

Dockerfile에도 그거 하라고 작성하면 되는데, `RUN node server.js` 하면 될 것 같지만 **보통 마지막 명령어는 RUN말고 CMD 뒤에 적습니다.**

```docker
FROM node:20-slim
WORKDIR /app
COPY . .
RUN ["npm", "install"]
CMD ["node", "server.js"]

```

### CMD vs ENTRYPOINT

CMD 대신에 **ENTRYPOINT**라고 적을 수도 있는데 차이점은 사소합니다.

## 6️⃣ EXPOSE 명령어 - 포트 설정

```docker
FROM node:20-slim
WORKDIR /app
COPY . .
RUN ["npm", "install"]
EXPOSE 8080
CMD ["node", "server.js"]

```

EXPOSE 명령어 뒤에 `8080` 이런 식으로 포트번호를 기재할 수 있습니다.

### 포트란?

**포트가 뭐냐면 컴퓨터에 뚫린 구멍입니다.**

이게 뚫려있어야 외부 사람들이 내 컴퓨터로 접속이 가능해서 웹서버 운영하는 컴퓨터도 포트를 하나 뚫어줘야합니다.

### EXPOSE의 역할

- 코드짤 때 8080 이런 포트를 뚫으라고 코드짜놨음
- 이미지 돌릴 컴퓨터에도 8080 포트를 오픈하라고 해야하는데 그건 이미지 실행할 때 명령줄 수 있음
- **EXPOSE 8080** 이런걸 작성해놓으면 나중에 포트 오픈하라고 명령줄 때 약간 편리함
- **편의를 위해 쓰는 메모같은 개념입니다. 없어도 상관은 없음**

## 7️⃣ 이미지 빌드하기 - docker build

Dockerfile 작성했으면 이걸 바탕으로 이미지를 하나 만들어달라고 명령내릴 수 있습니다.

### 기본 명령어

```bash
docker build -t 이미지이름:태그 .

```

**작업폴더에서 터미널 열어서 입력해봅시다.**

### 매개변수 설명

- **이미지 이름**: 맘대로 작명
- **태그**: 맘대로 작명 (태그는 버전이랑 비슷하게 취급하면 됨)
- **마침표**: Dockerfile 경로 입력 (마침표는 현재경로라는 뜻)

### 주의사항

**docker desktop 또는 docker engine이 실행되고 있어야 이거 명령어도 사용가능합니다.**

### 이미지 확인

입력하면 커스텀 이미지가 생성됩니다.

- docker desktop 들어가보기
- 터미널에 `docker images` 입력해보기

## 8️⃣ 이미지 실행하기

만든 이미지 실행 잘 되나 확인해봅시다.

### GUI에서 실행

재생버튼 누르거나 포트 부분에 8080을 기입해서 실행해봅시다.

**의미**: 누가 내 컴퓨터 8080번 포트로 들어오면 가상 컴퓨터의 8080번 포트로 연결하라는 뜻입니다.

### 터미널에서 실행

```bash
docker run -p 8080:8080 이미지명:태그명

```

### 테스트하기

브라우저 켜서 `localhost:8080`으로 들어가보면 웹서버를 만날 수 있습니다.

**이게 나만의 커스텀 이미지만들고 실행하는 법 끝입니다.**

이제 이 이미지를 다른 컴퓨터로 보내서 실행만 하면 그게 배포 아니겠습니까.

### 참고사항

- **localhost**: 내 컴퓨터로 접속하라는 뜻
- **docker init**: `docker init` 명령어 입력하면 Dockerfile을 약간 자동완성 해주기 때문에 거기서 필요한거 수정해서 쓰는 방법도 좋습니다

## 💡 전체 실습 예제

### Node.js Express 서버 예제

```docker
FROM node:20-slim
WORKDIR /app
COPY . .
RUN ["npm", "install"]
EXPOSE 8080
CMD ["node", "server.js"]

```

### .dockerignore 파일

```
.git
Dockerfile
node_modules

```

### 빌드 및 실행

```bash
# 이미지 빌드
docker build -t my-node-app:1.0 .

# 컨테이너 실행
docker run -p 8080:8080 my-node-app:1.0

# 브라우저에서 localhost:8080 접속하여 확인

```

## 📝 핵심 명령어 요약

### Dockerfile 명령어

- **FROM**: OS 환경 선택 (항상 첫 번째)
- **WORKDIR**: 작업 폴더 설정
- **COPY**: 파일 복사
- **RUN**: 명령어 실행 (빌드 시)
- **EXPOSE**: 포트 문서화 (메모 역할)
- **CMD**: 컨테이너 시작 명령어

### Docker 명령어

- **docker build**: 이미지 생성
- **docker run**: 컨테이너 실행
- **docker images**: 이미지 목록 확인
